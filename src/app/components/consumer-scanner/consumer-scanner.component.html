<div class="scanner-page">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
      <a class="navbar-brand" (click)="navigateHome()" style="cursor: pointer;">
        <span class="fs-4 fw-bold text-success">🌱 AgroTrace</span>
      </a>
      <button class="btn btn-outline-success" (click)="navigateHome()">
        <i class="bi bi-house"></i> მთავარი
      </button>
    </div>
  </nav>

  <!-- Scanner Section -->
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="text-center mb-5">
          <h1 class="display-4 fw-bold mb-3">დაასკანირე QR კოდი</h1>
          <p class="lead text-muted">
            გაიგე პროდუქტის სრული ისტორია - თესლიდან მაღაზიამდე
          </p>
        </div>

        <div class="card shadow-lg border-0 mb-4">
          <div class="card-body p-5">
            <div class="text-center mb-4">
              <div class="scanner-placeholder">
                @if (showCamera) {
                  <div class="camera-container mb-3">
                    <video #videoElement autoplay playsinline muted class="camera-preview"></video>
                    <div class="camera-overlay">
                      <div class="scan-frame"></div>
                      @if (isScanning) {
                        <p class="text-white mt-3">
                          <i class="bi bi-search"></i> QR კოდის ძებნა...
                        </p>
                      }
                    </div>
                  </div>
                  @if (cameraError) {
                    <div class="alert alert-danger mb-3">
                      <i class="bi bi-exclamation-triangle"></i>
                      {{ cameraError }}
                    </div>
                  }
                  <button class="btn btn-outline-danger" (click)="stopCamera()">
                    <i class="bi bi-x-circle"></i> კამერის დახურვა
                  </button>
                } @else {
                  <i class="bi bi-qr-code-scan display-1 text-success mb-3"></i>
                  <div class="d-flex flex-column align-items-center gap-2">
                    <button class="btn btn-success btn-lg" (click)="startCamera()">
                      <i class="bi bi-camera"></i> კამერით სკანირება
                    </button>
                    <p class="text-muted small mt-2">
                      გამოიყენეთ კამერა ან შეიყვანეთ პროდუქტის კოდი ხელით
                    </p>
                  </div>
                }
              </div>
            </div>

            <div class="divider my-4">
              <span class="divider-text">ან</span>
            </div>

            <!-- Manual Input -->
            <div class="manual-input">
              <h5 class="text-center mb-3">შეიყვანეთ პროდუქტის ID</h5>
              <div class="input-group input-group-lg mb-3">
                <input
                  type="text"
                  class="form-control"
                  [(ngModel)]="manualCode"
                  placeholder="მაგ: DEMO001"
                  (keyup.enter)="searchByCode()">
                <button
                  class="btn btn-success"
                  type="button"
                  (click)="searchByCode()">
                  <i class="bi bi-search"></i> ძებნა
                </button>
              </div>

              @if (errorMessage) {
                <div class="alert alert-warning alert-dismissible fade show" role="alert">
                  <i class="bi bi-exclamation-triangle"></i>
                  {{ errorMessage }}
                  <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
                </div>
              }

              <div class="text-center mt-4">
                <p class="text-muted mb-2">არ იცით პროდუქტის ID?</p>
                <button class="btn btn-outline-success" (click)="viewAllProducts()">
                  <i class="bi bi-list"></i> ნახეთ ყველა პროდუქტი
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Info Cards -->
        <div class="row mt-5">
          <div class="col-md-4 mb-3">
            <div class="info-card text-center p-4">
              <i class="bi bi-shield-check text-success fs-1 mb-3"></i>
              <h5>ვერიფიცირებული</h5>
              <p class="text-muted small">ბლოკჩეინით დაცული ინფორმაცია</p>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="info-card text-center p-4">
              <i class="bi bi-geo-alt text-success fs-1 mb-3"></i>
              <h5>განვლილი გზა</h5>
              <p class="text-muted small">სრული მოგზაურობის ისტორია</p>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="info-card text-center p-4">
              <i class="bi bi-award text-success fs-1 mb-3"></i>
              <h5>სერტიფიცირებული</h5>
              <p class="text-muted small">ორგანული და ბიო პროდუქტები</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
